<script>
    const bpmDisplay = document.getElementById('bpmDisplay');
    const rpmDisplay = document.getElementById('rpmDisplay');
    const startButton = document.getElementById('startButton');
    let audioContext, analyser, dataArray;

    startButton.addEventListener('click', function() {
        // Request access to the microphone
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
                // Create an audio context
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioContext.createMediaStreamSource(stream);
                analyser = audioContext.createAnalyser();

                // Set up analyser properties
                analyser.fftSize = 2048;
                const bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);

                // Connect the audio input stream to the analyser
                source.connect(analyser);

                // Feedback to user
                alert('Microphone access granted! Listening for beats...');
                startButton.textContent = "Listening...";
                
                // Start analyzing the audio stream
                analyzeAudio();
            })
            .catch(err => {
                console.error('Error accessing microphone: ', err);
                alert('Microphone access denied. Please allow access to continue.');
            });
    });

    function analyzeAudio() {
        requestAnimationFrame(analyzeAudio);
        analyser.getByteTimeDomainData(dataArray);

        // Placeholder for beat detection logic
        // For now, we'll just show random BPM and RPM values as a demo
        let bpm = Math.floor(Math.random() * 120) + 60;  // Random BPM between 60 and 180
        let rpm = bpm / 2;
        bpmDisplay.textContent = bpm;
        rpmDisplay.textContent = rpm.toFixed(1);
    }
</script>
